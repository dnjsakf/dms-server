-- JOB MASTER
-- DROP TABLE BATCH_JOB_MST;
CREATE TABLE BATCH_JOB_MST (
  JOB_ID BIGINT(20) NOT NULL COMMENT 'JOB ID',
  JOB_NAME VARCHAR(50) NOT NULL COMMENT 'JOB NAME',
  JOB_PARAMS VARCHAR(4000) NOT NULL COMMENT 'JOB PARAMS',
  JOB_DESC VARCHAR(4000) COMMENT 'JOB DESC',
  PUASE_YN VARCHAR(1) DEFAULT 'N' COMMENT 'PUASE: Y:true, N:false',
  USE_YN VARCHAR(1) DEFAULT 'N' COMMENT 'USEABLE: Y:true, N:false',
  REG_DTTM DATETIME COMMENT 'CREATED DATETIME',
  UPD_DTTM DATETIME COMMENT 'UPDATED DATETIME'
);

ALTER TABLE BATCH_JOB_MST ADD CONSTRAINT BATCH_JOB_MST_PK PRIMARY KEY (JOB_ID);

-- SCHEDULE MASTER
-- DROP TABLE BATCH_SCHEDULE_MST;
CREATE TABLE BATCH_SCHEDULE_MST (
  SCH_ID BIGINT(20) NOT NULL COMMENT 'SCH ID',
  JOB_ID BIGINT(20) NOT NULL COMMENT 'JOB ID',
  SCH_TYPE VARCHAR(10) NOT NULL COMMENT 'SCHDULE TYPE: cron, exec',
  SCH_CRON VARCHAR(30) NOT NULL COMMENT 'SCHDULE CRONTAB',
  SCH_START_DTTM DATETIME NOT NULL COMMENT 'SCHEDULE START DATETIME',
  SCH_END_DTTM DATETIME NOT NULL COMMENT 'SCHEDULE END DATETIME',
  SCH_NEXT_DTTM DATETIME NOT NULL COMMENT 'SCHEDULE NEXT DATETIME',
  PUASE_YN VARCHAR(1) DEFAULT 'N' COMMENT 'PUASE: Y:true, N:false',
  USE_YN VARCHAR(1) DEFAULT 'N' COMMENT 'USEABLE: Y:true, N:false',
  REG_DTTM DATETIME COMMENT 'CREATED DATETIME',
  UPD_DTTM DATETIME COMMENT 'UPDATED DATETIME'
);

ALTER TABLE BATCH_SCHEDULE_MST ADD CONSTRAINT BATCH_SCHEDULE_MST_PK PRIMARY KEY (SCH_ID, JOB_ID);

-- SCHEDULE LIST
-- DROP TABLE BATCH_SCHEDULE_LIST;
CREATE TABLE BATCH_SCHEDULE_LIST (
  SCH_ID BIGINT(20) NOT NULL COMMENT 'SCH ID',
  JOB_ID BIGINT(20) NOT NULL COMMENT 'JOB ID',
  RUN_ID BIGINT(20) NOT NULL COMMENT 'RUN ID',
  RUN_STATUS VARCHAR(16) NOT NULL COMMENT 'RUN STATUS: init, ready, running, complete, error',
  RUN_MESSAGE VARCHAR(4000) COMMENT 'JOB MESSAGE',
  START_DTTM DATETIME COMMENT 'STARTED DATETIME',
  END_DTTM DATETIME COMMENT 'FINISHED DATETIME',
  RUNTIME BIGINT(20) COMMENT 'RUNNING TIME',
  REG_DTTM DATETIME COMMENT 'CREATED DATETIME',
  UPD_DTTM DATETIME COMMENT 'UPDATED DATETIME'
);


ALTER TABLE BATCH_SCHEDULE_LIST ADD CONSTRAINT BATCH_SCHEDULE_LIST_PK PRIMARY KEY (SCH_ID, JOB_ID, RUN_ID);

ALTER TABLE BATCH_SCHEDULE_MST ADD CONSTRAINT BATCH_SCHEDULE_MST_BATCH_JOB_MST_FK FOREIGN KEY (JOB_ID) REFERENCES dochi.BATCH_JOB_MST(JOB_ID);
ALTER TABLE BATCH_SCHEDULE_LIST ADD CONSTRAINT BATCH_SCHEDULE_LIST_BATCH_SCHEDULE_MST_FK FOREIGN KEY (SCH_ID,JOB_ID) REFERENCES BATCH_SCHEDULE_MST(SCH_ID,JOB_ID);


CREATE OR REPLACE SEQUENCE BATCH_JOB_ID_SEQ INCREMENT BY 1 MINVALUE 1 MAXVALUE 99999999999999999 NOCYCLE;
CREATE OR REPLACE SEQUENCE BATCH_SCH_ID_SEQ INCREMENT BY 1 MINVALUE 1 MAXVALUE 99999999999999999 NOCYCLE;
CREATE OR REPLACE SEQUENCE BATCH_RUN_ID_SEQ INCREMENT BY 1 MINVALUE 1 MAXVALUE 99999999999999999 NOCYCLE;



